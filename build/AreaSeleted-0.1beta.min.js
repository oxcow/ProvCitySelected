function XmlDom(){if(window.ActiveXObject){try{var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;return a}catch(b){b.reason}throw Error("MSXML is not installed on you system.");}if(document.implementation&&document.implementation.createDocument)return a=document.implementation.createDocument("","",null),a.addEventListener("load",function(){this.__changeReadyState__()},!1),a.async=!1,a;throw Error("Your browser doesn't support an XML DOM object.");}
"undefined"!=typeof Document&&(Document.prototype.onreadystatechange=null,Document.prototype.__changeReadyState__=function(){if("function"==typeof this.onreadystatechange)this.onreadystatechange()},Document.prototype.loadXML=function(a){for(a=(new DOMParser).parseFromString(a,"text/xml");this.firstChild;)this.removeChild(this.firstChild);for(var b=0;b<a.childNodes.length;b++){var c=this.importNode(a.childNodes[b],!0);this.appendChild(c)}},Node.prototype.__defineGetter__("xml",function(){return(new XMLSerializer).serializeToString(this,
"text/xml")}),Element.prototype.selectNodes=function(a){var a=(new XPathEvaluator).evaluate(a,this,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),b=[];if(null!=a)for(var c=a.iterateNext();c;)b.push(c),c=a.iterateNext();return b},Element.prototype.selectSingleNode=function(a){a=(new XPathEvaluator).evaluate(a,this,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return null!=a?a.singleNodeValue:null},Element.prototype.count=function(a){var b=0;if(a=(new XPathEvaluator).evaluate("count("+a+")",this,
null,XPathResult.NUMBER_TYPE,null))b=a.numberValue;return b},Element.prototype.isMatch=function(a){return(new XPathEvaluator).evaluate(a,this,null,XPathResult.BOOLEAN_TYPE,null).booleanValue});function loadxml(){var a=+new Date,b=XmlDom();if(typeof b.load=="undefined"){b=new XMLHttpRequest;b.open("POST","areadata.xml",false);b.setRequestHeader("Content-Type","application/xml");b.send(null);b=b.responseXML}else b.load("areadata.xml");console.log("load xml spend : "+(+new Date-a)+" ms");return b}
function HtmlSelect(a,b,c){this.id=a;this.name=b;this.val=c;this.select=this.createSelect_()}HtmlSelect.prototype.createSelect_=function(){var a=document.createElement("select");a.setAttribute("id",this.id);a.setAttribute("name",this.name);return a};HtmlSelect.prototype.addOption=function(a,b){var c=document.createElement("option");c.appendChild(document.createTextNode(b));c.setAttribute("value",a);this.val&&a==this.val&&c.setAttribute("selected","selected");this.select.appendChild(c)};
HtmlSelect.prototype.cleanOptions=function(){if(this.select&&this.select.options.length!=0)for(var a=this.select.options.length-1;a>=0;a--)this.select.remove(this.select.options[a])};HtmlSelect.prototype.showHtml=function(a){document.getElementById(a).appendChild(this.select)};function LinkageMenu(a,b,c,d){this.xml=LinkageMenu.xml?LinkageMenu.xml:loadxml();this.offset=a;this.id=b;this.name=c;this.val=d;this.htmlSelect=new HtmlSelect(this.id,this.name,this.val)}LinkageMenu.xml=loadxml();
LinkageMenu.prototype.init=function(a){a=this.xml.documentElement.selectNodes(a);if(!this.val&&a[0]){this.val=a[0].getAttribute("name");this.htmlSelect.val=this.val}for(var b=0;b<a.length;b++)this.htmlSelect.addOption(a[b].getAttribute("name"),a[b].getAttribute("name"));this.htmlSelect.showHtml(this.offset)};
LinkageMenu.prototype.change=function(){var a=LinkageMenu["link_"+this.id];a.htmlSelect.cleanOptions();for(var b=a.xPath.replace("&var",this.value),b=a.xml.documentElement.selectNodes(b),c=0;c<b.length;c++)a.htmlSelect.addOption(b[c].getAttribute("name"),b[c].getAttribute("name"));if(a=LinkageMenu["link_"+a.id]){a.htmlSelect.cleanOptions();b=b[0].childNodes;for(c=0;c<b.length;c++)b[c].nodeType==1&&a.htmlSelect.addOption(b[c].getAttribute("name"),b[c].getAttribute("name"))}};
function Province(a,b,c,d){LinkageMenu.call(this,a,b,c,d);this.xPath="//province";this.init(this.xPath)}Province.prototype=new LinkageMenu;Province.prototype.linkCity=function(a){a.xPath="//province[@name='&var']/city";LinkageMenu["link_"+this.id]=a;this.htmlSelect.select.onchange=this.change;if(this.val){var b=a.xPath.replace("&var",this.val);a.init(b)}};function City(a,b,c,d,e){LinkageMenu.call(this,a,b,c,d);this.xPath="//city";e&&this.init(this.xPath)}City.prototype=new LinkageMenu;
City.prototype.linkArea=function(a){a.xPath="//city[@name='&var']/country";LinkageMenu["link_"+this.id]=a;this.htmlSelect.select.onchange=this.change;if(this.val){a.htmlSelect.cleanOptions();var b=a.xPath.replace("&var",this.val);a.init(b)}};function Area(a,b,c,d,e){LinkageMenu.call(this,a,b,c,d);this.xPath="//country";e&&this.init(this.xPath)}Area.prototype=new LinkageMenu;
